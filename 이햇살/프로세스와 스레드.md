# 프로세스와 스레드

## 1. 프로그램, 프로세스, 스레드

### 1.1 프로그램(Program)

> 어떤 작업을 위해 실행할 수 있는 파일. `정적인 상태`
>
> - 어떤 데이터를 사용해서 어떤 작업을 할지 절차들을 담은 실행할 수 있는 파일을 의미
> - 저장장치(하드디스크)에 저장되어 있어 그 자체로는 정적인 파일
> - 프로세스와 프로그램의 주요 차이점은 **실제 작동하는 상태(동적인)이냐의 유무**

### 1.2 프로세스(Process)

> 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
>
> OS의 관점에서 하나의 `작업`단위. `실행 중인 프로그램`
>
> - 프로그램을 메모리에 올린 동적인 상태
>
>   → `프로그램이 실행되면 프로세스 인스턴스가 생성`된다고 표현
>
> - OS가 프로그램을 메모리에 올리고 CPU를 위한 **PCB(Process Control Block : 프로세스 제어 블록)을 할당**한 상태
>
> - `프로세스`란 프로그램 + PCB
>
> - 스케줄러의 입장에서 `task(작업)`

- 메모리에 올라와 **실행되고 있는 프로그램의 인스턴스(독립적인 개체)**
- 운영체제로부터 시스템 자원을 할당받는 작업의 단위
- 즉, 동적인 개념으로는 실행된 프로그램을 의미

#### 1.2.1 할당받는 시스템 자원의 예

- CPU 시간
- 운영되기 위해 필요한 주소 공간
- Code, Data, Stack, Heap의 구조로 되어 있는 독립된 메모리 영역

#### 1.2.2 특징

<img src="C:\Users\haetsal\AppData\Roaming\Typora\typora-user-images\image-20230806233731123.png" alt="image-20230806233731123" style="zoom: 67%;" />

- 프로세스는 각각 독립된 메모리 영역(Code, Data, Stack, Heap의 구조)을 할당받음

- 기본적으로 프로세스당 최소 1개의 스레드(메인 스레드)를 가지고 있음

- 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없음

- 한 프로세스가 다른 프로세스의 자원에 접근하려면 프로세스 간의 통신(IPC, inter-process communication)을 사용해야 함

  ex) 파이프, 파일, 소켓 등을 이용한 통신 방법 이용

### 1.3 스레드(Thread)

> CPU 관점에서의 `실행` 단위
>
> - 프로세스가 작업의 전체라면 스레드는 작업을 처리하기 위해서 수행하는 `실행` 단위
>
> - CPU에서 처리하는 실행 하나가 `스레드`
>
>   → 프로세스가 생성되면 CPU 스케줄러는 프로세스가 해야 할 일들을 CPU에 전달하는데 이때의 단위가 스레드
>
> - CPU는 프로세스로부터 전달받은 스레드를 수행
>
> - `OS입장`에서 작업은 `프로세스`이고, `CPU`의 작업은 `프로세스 내의 스레드`
>
> - 프로세스는 최소한 1개의 스레드를 가지며 2개 이상의 스레드를 가진 경우를 멀티 스레드

#### 1.3.1 특징

- 스레드는 프로세스내에서 동시에 실행되는 독립적인 실행 단위. 
- 프로세스 내에서 각각 Stack만 따로 할당받고 Code, Data, Heap 영역은 공유
- 스레드는 한 프로세스 내에서 동작되는 여러 실행의 흐름으로, 프로세스 내의 주소 공간이나 자원들 (힙 공간 등)과 같은 프로세스 내에 스레드끼리 공유하면서 실행
- 같은 프로세스 안에 있는 여러 스레드들은 같은 힙 공간을 공유

#### 1.3.2 **스레드 주소공간**

- 하나의 스레드가 동작하기 위해 총 6개
- 사적공간, 공유공간, 커널 스택
  - 사적공간
    - 스레드 코드 공간, 스레드 전용 전역변수 공간, 스택 공간
  - 공유공간
    - 데이터 공간, 힙 공간
  -  커널 스택

### 1.4 프로세스와 스레드의 차이

- `프로세스`메모리 상에서 실행중인 프로그램을 말하며

  `스레드`는 이 프로세스 안에서 실행되는 흐름 단위

- `프로세스`는 `최소 하나의 스레드를 보유`하고 있으며, 각각 별도의 주소공간을 독립적으로 할당 받음(code, heap, stack) 

  `스레드`는 이중에 `stack만 따로 할당`받고 나머지 영역은 스레드끼리 서로 공유

---

- 프로세스 : 자신만의 고유 공간과 자원을 할당받아 사용
- 스레드 : 다른 스레드와 공간과 자원을 공유하면서 사용

### 1.5 스레드의 출현 목적

- 프로세스의 문제점
  - 프로세스 생성에 큰 오버헤드 → 프로세스를 생성할때 많은 시간이 소요됨
  - 프로세스 컨텍스트 스위칭의 비효율성, 오버헤드가큼
  - 프로세스 사이에 통신이 어렵다는점 (IPC사용해야함)
- 스레드의 출현 목적
  - 프로세스보다 크기가 작은 실행 단위 필요
  - 프로세스의 생성 및 소멸에 따른 오버헤드 감소
  - 빠른 컨텍스트 스위칭
  - 프로세스들의 통신 시간, 방법 어려움 해소

## 2. 멀티 프로세스 대신 멀티 스레드를 사용하는 이유

`프로그램을 여러 개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결하는 것`

- 자원의 효율성 증대
  - 멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리
    - 프로세스 간의 Context Switching시 단순히 CPU 레지스터 교체 뿐만 아니라 RAM과 CPU 사이의 캐시 메모리에 대한 데이터까지 초기화되므로 오버헤드가 크기 때문
  - 스레드는 프로세스 내의 메모리를 공유하기 때문에 독립적인 프로세스와 달리 스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 감소
- 처리 비용 감소 및 응답 시간 단축
  - 프로세스 간의 통신(IPC)보다 스레드 간의 통신의 비용이 적으므로 작업들 간의 통신의 부담 감소
    - 스레드는 Stack 영역을 제외한 모든 메모리를 공유하기 때문
  - 프로세스 간의 전환 속도보다 스레드 간의 전환 속도가 빠름
    - Context Switching시 스레드는 Stack 영역만 처리하기 때문

* 주의할 점
  * 동기화 문제
  * 스레드 간의 자원 공유는 전역 변수(데이터 세그먼트)를 이용하므로 함께 상용할 때 충돌이 발생 가능성

## 3. Thread-safe

### 3.1 Thread-safe란?

- 직역하면 `스레드 안전`

- 멀티스레드 환경에서 여러 스레드가 동시에 하나의 객체 및 변수(공유 자원)에 접근할 때, 의도한 대로 동작하는 것

  → 이러한 상황을 `Thead-safe하다`라고 표현

### 3.2 Thread-safe하게 구현

- Thread-safe하기 위해서는 공유 자원에 접근하는 임계영역(critical section)을 동기화 기법으로 제어 필요

  → 이를 `상호배제`라고 함

- 동기화 기법으로는 Mutex나 Semaphore 등

### 3.3 Reentrant

- Reentrant는 `재진입성`이라는 의미로, 어떤 함수가 Reentrant하다는 것은 여러 스레드가 동시에 접근해도 언제나 같은 실행 결과를 보장한다는 의미

- 이를 만족하기 위해서 해당 서브루틴에서는 공유자원을 사용하지 않으면 됨

  → 예를들어 정적(전역) 변수를 사용하거나 반환하면 안 되고 호출 시 제공된 매개변수만으로 동작해야 함

- 따라서, Reentrant하다면 Thread-safe하지만 그 역은 성립하지 않는다.

---

참고

[프로세스(Process)와 스레드(Thread)의 차이점. [ 운영체제(OS) 면접 질문 1]](https://murphymoon.tistory.com/entry/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4Process%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9CThread%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-%EB%A9%B4%EC%A0%91-%EC%A7%88%EB%AC%B8-1)

[WeareSoft 깃헙 기술 면접 질문 : 프로세스-스레드 편](https://github.com/WeareSoft/tech-interview/blob/master/contents/os.md#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4)

[[개발자 면접] 프로세스와 스레드의 차이점](https://zeroco.tistory.com/75)